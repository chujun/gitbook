# 岗位能力要求
通用能力(30%)
* 学习能力
* 抗压能力
* 人才培养

专业能力(50%)

业绩完成(20%)

# 主要讲解思路
工作履历介绍->主要业务介绍
->主要问题->解决方法->解决措施
->营造技术氛围

工作履历介绍
14年毕业先后任职途牛，饿了么,众安公司
18年12月入职爱回收,2年多
C2B研发部门中台组(定位:下游和基础服务等打交道,上游和多个应用端打交道)
短小精干的团队,后端5人,前端5人,


主要业务介绍

主要负责以旧换新相关业务
换新订单系统，商品系统

维修业务，支持多家供应商和支持开放平台开发者接入
维修订单系统,供应商开放平台网关系统

支持其他中台业务需求
通用业务短信平台

等等

支撑以旧换新业务发展
* 现在日均3000单
* 多种业务模式(官网线上换新,门店线下换新,BD一站式换新(京东,华为,小米),加盟新机,供应商模式)
* 支持多种优惠方式(优惠券,加价购，满减)

* 期间经历了好多个大版本更迭，多次跨团队合作
** 支持一站换新模型订单，支持多渠道
** 支撑底层换新从php切换到java
** 主导了订单流的设计与开发
  
业务发展期间主要碰到了哪些典型业务问题和技术问题，又是怎么解决的呢
不同角度
* 订单流(业务催生)
* 消费者消息发送超时失败(纯技术,技术完备性)
* 定时任务(提高开发效率)

-->问题列表
* 代码可维护性极差(很难阅读)
* 订单状态翻转回之前的状态

-->核心诉求
* 订单状态翻转
* 设计一个通用状态机，可以运用到多个业务系统中，而不仅仅是针对订单的订单状态机

* 根据复杂业务上下文判断当前状态翻转到哪个状态
* 同一个节点支持多流向，多动作
* 动作支持不同角色操作(取消)
* 不同订单流程相同状态需要处理的业务逻辑也不尽相同--->多条件处理器(另一个组件，支持注解描述条件)
核销(官网核销VS一站换新核销)
* 支持幂等
* 允许跳转回前置状态

-->采取了哪些方法
现有方案
* 参考现有的框架：流程引擎(太重量级了)
* 借鉴其他组的一些解决方案(
  依据几个固定条件控制状态翻转,(渠道,取货方式)
  流程执行树)

-->解决措施
模型
*流程(Process) 基于图的遍历算法
*节点(ProcessNode)
*流向(ProcessFlow)
*动作(ProcessAction)
*角色(ProcessOperator)
*操作上下文(ProcessBiz)
*业务流程上下文(BizProcessContext)

组件
*流程引擎(ProcessEngine)
*业务流程绑定器(ProcessBinder)
*流程执行调用链(ProcessExecuteCallChain)
*流程加载器(ProcessLoader) yml/db
*流程持有器(ProcessHolder)

订单流组件交互图
订单状态流执行过程分析

分享链接

-->后续改进计划

订单状态流设计


问题->怎么解决->实现
消息发送失败补偿器
问题：人肉线下处理，很麻烦

避免手工操作->消息补偿
容易漏单
组件的完备性

设计
redis队列补偿,重试,熔断器
直接上组件图

优化:支持http方式补偿消息

优化
问问题
ZPOPMIN key [count]
起始版本：5.0.0
时间复杂度：O(log(N)*M) with N being the number of elements in the sorted set, and M being the number of elements popped.

定时任务开发

问题:
统计需求(总数,成功，失败)
日志定位，没有链路id(uuid)

思路
模板设计模式

团队推广
交流
有效提高开发效率
促进退队交流

营造技术氛围
* 定期的技术分享(订单流设计承上)
* service-starter
** 组件,状态流,消息补偿组件
** 工具类,小的工具帮助类都可以pr进去，定时任务开发帮助类
  Assertion(继承ServiceException)，
** 交流  @DocumentedEnumValid注解 相互沟通交流，有好的点子分享出来，相互使用
  
致力于营造良好的技术氛围，感谢张磊的领导  
学习

技术分享
-为什么分享
-有什么收获所得

# 反思与提升
学以致用,运用到实际业务中去,促进业务的发展



# 想踩到的小点
* 跨团队合作
* 给个分享链接不就能有效证明分享了嘛




# 资料
[](http://confluence.aihuishou.com/pages/viewpage.action?pageId=37603738)


