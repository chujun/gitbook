# 中台订单服务状态机设计分享
# 1.问题
## 1.1引入状态机之前的代码现状
![引入状态机之前的代码现状](img/引入状态机之前的代码现状.png)
忽略TODO
代码坏味道
* 可读性差
* 可维护性差
## 1.2复杂的订单状态机
[换新订单流汇总](https://www.processon.com/view/link/5d5a542de4b04399f5aa0ad3)
## 1.3需要手动写大量的前置校验逻辑校验是否允许订单翻转订单状态
## 1.4线上踩过的坑:会碰到订单明明应该到目标状态却翻转回之前的状态
* 场景:一站换新订单重复收到合作方支付通知

## 
# 2.需求分析
## 进一步分析订单状态机

# 3.设计
## 目标
# 3.1设计一个通用状态机，可以运用到多个业务系统中，而不仅仅是针对订单的订单状态机
* 控制当前状态翻转到哪个状态
* 当前节点支持哪些动作操作
* 当前节点的动作允许哪些角色操作
* 同一个节点支持多流向，多动作

# 3.1可绘制，可视化输出能力(TODO)

## 4.架构
### 模型

### 组件

### 组件交互

# 5.show me code
## 代码组织架构

## 单元测试

## 引入状态机之后的代码效果
![流程引擎代码展示](img/流程引擎代码展示.png)
+
![动作处理器代码展示](img/动作处理器代码展示.png)

# 现状
# 6.展望
* 一个业务系统中支持多个状态机
* 引入SpEL,ognl等表达式支持复杂上下文表达式
* 状态机特性:自动跳过指定节点
* 前端可编辑,展示状态机，简化状态机维护成本和可视化输出
* 其他你想的


# 7.招贤令

